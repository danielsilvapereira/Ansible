  - name: Desabilitando o SELinux
    selinux:
     state: disabled

  - name: Instalando o pacote do zabbix no {{ansible_distribution}}-{{ansible_distribution_major_version}}
    dnf:
      disable_gpg_check: yes
      name: 'https://repo.zabbix.com/zabbix/6.0/rhel/{{ansible_distribution_major_version}}/x86_64/zabbix-release-6.0-1.el8.noarch.rpm'
      state: present
    when: ansible_distribution_major_version == '8'

  - name: Instalando Zabbix Agent 2 no {{ansible_distribution}}-{{ansible_distribution_major_version}}
    dnf:
     name: zabbix-agent2
     enablerepo: zabbix
     update_cache: true
     state: latest
    when: ansible_distribution_major_version == '8'

  - name: Instalando o pacote do zabbix no {{ansible_distribution}}-{{ansible_distribution_major_version}}
    yum:
      disable_gpg_check: yes
      name: 'https://repo.zabbix.com/zabbix/6.0/rhel/{{ansible_distribution_major_version}}/x86_64/zabbix-release-6.0-1.el8.noarch.rpm'
      state: present
    when: ansible_distribution_major_version == '7'
 
  - name: Instalando Zabbix Agent 2 no {{ansible_distribution}}-{{ansible_distribution_major_version}}
    yum:
     name:
        - zabbix-agent2
        - zabbix-get
        - zabbix-sender 
    when: ansible_distribution_major_version == '7'

  - name: Aplicando as configurações
    tags: setupconfig
    template:
      src: templates/zabbix_agentd2.j2
      dest: /etc/zabbix/zabbix_agentd2.conf
      owner: zabbix
      group: zabbix
      mode: 0644

  - name: Alterando as permissões
    file:
      path: /etc/zabbix/
      mode: 0775
      owner: zabbix
      group: zabbix  

  - name: Habilitando e iniciando o serviço
    systemd:
      name: zabbix-agent2
      state: started
      enabled: yes

  - name: Liberando as portas no firewalld
    firewalld:
      port: 10050/tcp
      permanent: yes
      state: enabled
  
  - name: Reiniciando o firewalld
    systemd:
      name: firewalld
      state: reloaded
      enabled: yes  
